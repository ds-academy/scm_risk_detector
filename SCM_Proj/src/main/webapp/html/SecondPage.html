<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SPAndTech</title>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="../css/SecondPage.css">
</head>
<body>
	<nav class="navbar">
		<div class="logo">
			<i class="fas fa-leaf"></i> SPAndTech
		</div>
		<div class="nav-links">
			<a href="#">í™ˆ</a> <a href="#">ë§ˆì´í˜ì´ì§€</a> <a href="#">ì„¤ì •</a> <a
				href="#">ë¦¬ìŠ¤í¬</a>
		</div>
		<div class="search-bar">
			<input type="text" placeholder="ì¢…ëª©ëª…, ì¢…ëª©ì½”ë“œ ê²€ìƒ‰">
		</div>
		<button class="btn-login">ë¡œê·¸ì¸</button>
	</nav>

	<main class="main-content">
<!-- 		<section class="sentiment-news">
			<div class="news-header">
				<div class="news-icon positive">
					<i class="fas fa-arrow-up"></i>
				</div>
				<h2 class="section-title">ê¸ì • ë‰´ìŠ¤</h2>
			</div>
			<table id="newsTable">
				<thead>
					<tr>
						<th class="news-title">ë‰´ìŠ¤ ì œëª©</th>
						<th class="news-meta">ë‰´ìŠ¤ ë©”íƒ€</th>
					</tr>
				</thead>
				<tbody>
					AJAXë¡œ ë°›ì•„ì˜¨ ë‰´ìŠ¤ ë°ì´í„°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
				</tbody>
			</table> -->


			<!-- 			<div class="news-item">
				<div class="news-title">ë°˜ë„ì²´ ìˆ˜ì¶œ ì¦ê°€ì„¸ ì§€ì†, ì „ë…„ ëŒ€ë¹„ 15% ìƒìŠ¹</div>
				<div class="news-meta">5ë¶„ ì „ â€¢ ê²½ì œì‹ ë¬¸</div>
			</div>
			<div class="news-item">
				<div class="news-title">ì£¼ìš” ê¸°ì—… ì‹¤ì  ì „ë§ì¹˜ ìƒí–¥ ì¡°ì •</div>
				<div class="news-meta">15ë¶„ ì „ â€¢ í…Œí¬ë‰´ìŠ¤</div>
			</div>
			<div class="news-item">
				<div class="news-title">ê¸€ë¡œë²Œ íˆ¬ììê¸ˆ êµ­ë‚´ ì£¼ì‹ì‹œì¥ ìœ ì… í™•ëŒ€</div>
				<div class="news-meta">30ë¶„ ì „ â€¢ íˆ¬ìì €ë„</div>
			</div> -->
<!-- 		</section> -->

 <section class="sentiment-news">
        <div class="news-header">
            <div class="news-icon positive">
                <i class="fas fa-arrow-up"></i>
            </div>
            <h2 class="section-title">ê¸ì • ë‰´ìŠ¤</h2>
        </div>
        <table id="newsTable">
            <thead>
                <tr>
                    <th class="news-title">ë‰´ìŠ¤ ì œëª©</th>
                    <th class="news-meta">ë‰´ìŠ¤ ë©”íƒ€</th>
                </tr>
            </thead>
            <tbody>
                <!-- AJAXë¡œ ë°›ì•„ì˜¨ ë‰´ìŠ¤ ë°ì´í„°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤. -->
            </tbody>
        </table>
    </section>

		<section class="sentiment-news">
			<div class="news-header">
				<div class="news-icon negative">
					<i class="fas fa-arrow-down"></i>
				</div>
				<h2 class="section-title">ë¶€ì • ë‰´ìŠ¤</h2>
			</div>
			<div class="news-item">
				<div class="news-title">ì›ìì¬ ê°€ê²© ìƒìŠ¹ìœ¼ë¡œ ê¸°ì—… ë¶€ë‹´ ê°€ì¤‘</div>
				<div class="news-meta">10ë¶„ ì „ â€¢ ê²½ì œì‹ ë¬¸</div>
			</div>
			<div class="news-item">
				<div class="news-title">ë¯¸ ì—°ì¤€ ê¸ˆë¦¬ ì¸ìƒ ìš°ë ¤ í™•ëŒ€</div>
				<div class="news-meta">20ë¶„ ì „ â€¢ ê¸€ë¡œë²Œë‰´ìŠ¤</div>
			</div>
			<div class="news-item">
				<div class="news-title">ì¤‘êµ­ ê²½ê¸° ë‘”í™” ì¡°ì§ì— ìˆ˜ì¶œê¸°ì—… ìš°ë ¤</div>
				<div class="news-meta">35ë¶„ ì „ â€¢ íˆ¬ìì €ë„</div>
			</div>
		</section>

		<section class="chart-section">
			<div class="stock-info">
				<select id="stockSelector" class="stock-selector">
					<option value="004370">ë†ì‹¬ (004370)</option>
					<option value="005380">í˜„ëŒ€ìë™ì°¨ (005380)</option>
					<option value="005930">ì‚¼ì„±ì „ì (005930)</option>
					<option value="034220">LGë””ìŠ¤í”Œë ˆì´ (034220)</option>
					<option value="051900">LGìƒí™œê±´ê°•(051900)</option>
					<option value="051910">LGí™”í•™ (051910)</option>
					<option value="073240">ê¸ˆí˜¸íƒ€ì´ì–´ (073240)</option>
					<option value="267260">HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­ (267260)</option>
				</select>
				<div class="stock-price">72,300ì›</div>
			</div>
			<div class="chart-wrapper">
				<canvas id="stockChart"></canvas>
			</div>
		</section>
		<section class="risk-section">
			<div class="stock-info">
				<select id="riskSelector" class="stock-selector">
					<option value="004370">ë†ì‹¬ (004370)</option>
					<option value="005380">í˜„ëŒ€ìë™ì°¨ (005380)</option>
					<option value="005930">ì‚¼ì„±ì „ì (005930)</option>
					<option value="034220">LGë””ìŠ¤í”Œë ˆì´ (034220)</option>
					<option value="051900">LGìƒí™œê±´ê°•(051900)</option>
					<option value="051910">LGí™”í•™ (051910)</option>
					<option value="073240">ê¸ˆí˜¸íƒ€ì´ì–´ (073240)</option>
					<option value="267260">HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­ (267260)</option>
				</select>
				<div class="stock-price">ìœ„í—˜ë„: 65%</div>
			</div>
			<div class="chart-wrapper">
				<canvas id="riskChart"></canvas>
			</div>
		</section>

	</main>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
    // jQuery ì½”ë“œ
	    $(document).ready(function() {
	        // jQuery ì½”ë“œ ì‚¬ìš©
	    });
	</script>


	<script>
        // ì£¼ì‹ ë°ì´í„° (ì˜ˆì‹œ)
        const stockData = {
            '004370': {
                name: 'ë†ì‹¬',
                data: [71000, 71200, 71800, 71500, 72100, 72400, 72300, 72300]
            },
            '005380': {
                name: 'í˜„ëŒ€ìë™ì°¨',
                data: [125000, 126000, 125800, 126500, 127000, 126800, 127200, 127500]
            },
            '005930': {
                name: 'ì‚¼ì„±ì „ì',
                data: [45000, 45200, 45500, 45300, 45800, 46000, 45900, 46200]
            },
            '034220': {
                name: 'LGë””ìŠ¤í”Œë ˆì´',
                data: [185000, 186000, 186500, 187000, 186800, 187500, 188000, 188200]
            },
            '051900': {
                name: 'LGìƒí™œê±´ê°•',
                data: [550000, 552000, 553000, 551000, 554000, 555000, 556000, 557000]
            },
            '051910': {
                name: 'LGí™”í•™',
                data: [175000, 176000, 176500, 177000, 176800, 177500, 178000, 178200]
            },
            '0073240': {
                name: 'ê¸ˆí˜¸íƒ€ì´ì–´',
                data: [820000, 822000, 823000, 821000, 824000, 825000, 826000, 827000]
            },
            '267260': {
                name: 'HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­',
                data: [450000, 452000, 453000, 451000, 454000, 455000, 456000, 457000]
            }
        };

        let chart;
        const ctx = document.getElementById('stockChart').getContext('2d');

        function createChart(stockCode) {
            const stockInfo = stockData[stockCode];
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '15:30'],
                    datasets: [{
                        label: 'ì£¼ê°€',
                        data: stockInfo.data,
                        borderColor: '#326CF9',
                        backgroundColor: 'rgba(50, 108, 249, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: `${stockInfo.name} ì£¼ê°€ (ì›)`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + 'ì›';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // ì£¼ê°€ ì—…ë°ì´íŠ¸
            document.querySelector('.stock-price').textContent = 
                stockInfo.data[stockInfo.data.length - 1].toLocaleString() + 'ì›';
        }

        // ì´ˆê¸° ì°¨íŠ¸ ìƒì„±
        createChart('005930');

        // SELECT ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('stockSelector').addEventListener('change', function(e) {
            createChart(e.target.value);
        });
    </script>
	<script>
        // ê³µê¸‰ë§ ìœ„í—˜ ë°ì´í„° (ì˜ˆì‹œ - 6ê°œì›”ì¹˜ ë°ì´í„°)
        const riskData = {
            '004370': {
                name: 'ë†ì‹¬',
                data: [65, 63, 68, 64, 62, 65],
                riskLevel: '65%'
            },
            '005380': {
                name: 'í˜„ëŒ€ìë™ì°¨',
                data: [70, 72, 75, 73, 71, 74],
                riskLevel: '74%'
            },
            '005930': {
                name: 'ì‚¼ì„±ì „ì',
                data: [45, 43, 44, 46, 45, 47],
                riskLevel: '47%'
            },
            '034220': {
                name: 'LGë””ìŠ¤í”Œë ˆì´',
                data: [48, 46, 45, 47, 49, 48],
                riskLevel: '48%'
            },
            '051900': {
                name: 'LGìƒí™œê±´ê°•',
                data: [78, 76, 75, 77, 79, 80],
                riskLevel: '80%'
            },
            '051910': {
                name: 'LGí™”í•™',
                data: [72, 70, 73, 75, 74, 73],
                riskLevel: '73%'
            },
            '073240': {
                name: 'ê¸ˆí˜¸íƒ€ì´ì–´',
                data: [55, 53, 54, 56, 55, 57],
                riskLevel: '57%'
            },
            '267260': {
                name: 'HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­',
                data: [68, 66, 65, 67, 69, 68],
                riskLevel: '68%'
            }
        };
        
        let riskChart;
        
        function createRiskChart(stockCode) {
            const riskInfo = riskData[stockCode];
            const ctxRisk = document.getElementById('riskChart').getContext('2d');
            
            if (riskChart) {
                riskChart.destroy();
            }
        
            riskChart = new Chart(ctxRisk, {
                type: 'line',
                data: {
                    labels: ['6ê°œì›” ì „', '5ê°œì›” ì „', '4ê°œì›” ì „', '3ê°œì›” ì „', '2ê°œì›” ì „', '1ê°œì›” ì „'],
                    datasets: [{
                        label: 'ê³µê¸‰ë§ ìœ„í—˜ë„',
                        data: riskInfo.data,
                        borderColor: '#FF3B30',
                        backgroundColor: 'rgba(255, 59, 48, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: `${riskInfo.name} ê³µê¸‰ë§ ìœ„í—˜ë„ ì¶”ì´ (ë‹¨ìœ„: %)`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        
            // ìœ„í—˜ë„ ì—…ë°ì´íŠ¸
            document.querySelector('.stock-price').textContent = `ìœ„í—˜ë„: ${riskInfo.riskLevel}`;
        }
        
        // ì´ˆê¸° ì°¨íŠ¸ ìƒì„±
        document.addEventListener('DOMContentLoaded', () => {
            createRiskChart('005930');
        });
        
        // SELECT ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('riskSelector').addEventListener('change', function(e) {
            createRiskChart(e.target.value);
        });
        </script>
<script>
var page = 0;
var limit = 3;
var allPositiveNews = [];  
var timer; 

function loadNews() {
    console.log("ğŸ“¡ AJAX ìš”ì²­ ì‹œì‘!");

    $.ajax({
        url: '/com.SCM_Pro.proj/newsController',  // URL í™•ì¸!
        method: 'GET',
        dataType: 'json',
        data: { action: 'getPositiveNews' },
        success: function(data) {
            console.log("âœ… ë°›ì€ ë°ì´í„°:", data);
            
            if (!Array.isArray(data)) {
                try {
                    allPositiveNews = JSON.parse(data);
                } catch (error) {
                    console.error("âŒ JSON ë³€í™˜ ì‹¤íŒ¨:", error);
                    return;
                }
            } else {
                allPositiveNews = data;
            }

            updatePositiveNews();    
        },
        error: function(xhr, status, error) {
            console.error("âŒ ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
        }
    });
}


function updatePositiveNews() {
    var tbody = $('#newsTable tbody');
    tbody.empty(); 

    let start = page * limit;
    let end = start + limit;
    let pagedNews = allPositiveNews.slice(start, end);

    if (pagedNews.length === 0) {
        page = 0;
        updatePositiveNews();
        return;
    }

    $.each(pagedNews, function(index, news) {
        console.log("í˜„ì¬ ë‰´ìŠ¤ ë°ì´í„°:", news);

        if (!news.title || !news.meta) {
            console.error("ë°ì´í„° í•„ë“œê°€ ë¶€ì¡±í•¨:", news);
            return;
        }

        var row = $('<tr class="news-item"></tr>');
        row.append($('<td class="news-title"></td>').text(news.title));
        row.append($('<td class="news-meta"></td>').text(news.meta));
        tbody.append(row);
    });

    page++; 
}

$(document).ready(function(){
    loadNews(); 
    timer = setInterval(updatePositiveNews, 3000);
});
</script>


</body>
</html>